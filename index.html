<!DOCTYPE html>
<html class="a-fullscreen">
<head>
    <meta charset="utf-8"> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>GeoAR Circle Grid</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="black">

    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        html.a-fullscreen { bottom: 0; left: 0; position: fixed; right: 0; top: 0; }
        html.a-fullscreen body { height: 100%; margin: 0; overflow: hidden; padding: 0; width: 100%; }
        a-scene { display: block; position: relative; height: 100%; width: 100%; }
    </style>

    <script>
       
        AFRAME.registerComponent('circle-grid', {
            init: function () {
                const sceneEl = this.el; // ent attached
                this.generateSquareRing(sceneEl.object3D, 1, 16, 0, "red");   // Inner Ring
                this.generateSquareRing(sceneEl.object3D, 17, 40, 0, "blue"); // Outer Ring
            },

            generateSquareRing: function(parent, start, end, dist, color) {
                const spacing = 0.85; 
                for (let num = start; num <= end; num++) {
                    let gridX = 0, gridZ = 0;
                    if (start === 1) {
                        const innerMap = {
                            16:[-1,-2], 1:[0,-2], 2:[1,-2], 3:[2,-2],
                            4:[2,-1], 5:[2,0], 6:[2,1], 7:[2,2],
                            8:[1,2], 9:[0,2], 10:[-1,2], 11:[-2,2],
                            12:[-2,1], 13:[-2,0], 14:[-2,-1], 15:[-2,-2]
                        };
                        [gridX, gridZ] = innerMap[num];
                    } else {
                        if (num >= 38 && num <= 40) { gridX = num - 41; gridZ = -3; }
                        else if (num >= 17 && num <= 20) { gridX = num - 17; gridZ = -3; }
                        else if (num >= 21 && num <= 25) { gridX = 3; gridZ = num - 23; }
                        else if (num >= 26 && num <= 32) { gridX = 29 - num; gridZ = 3; }
                        else if (num >= 33 && num <= 37) { gridX = -3; gridZ = 35 - num; }
                    }
                    const marker = this.createMarker(num, color);
                    marker.position.set(gridX * spacing, 0, gridZ * spacing);
                    parent.add(marker);
                }
            },

            createMarker: function(num, color) {
                const THREE = AFRAME.THREE;
                const g = new THREE.Group();
                const ring = new THREE.Mesh(
                    new THREE.RingGeometry(0.25, 0.32, 32).rotateX(-Math.PI/2),
                    new THREE.MeshBasicMaterial({ color: color })
                );
                g.add(ring);

                const canvas = document.createElement('canvas');
                canvas.width = 128; canvas.height = 128;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = "white"; ctx.font = "bold 70px Arial"; ctx.textAlign = "center";
                ctx.fillText(num, 64, 85);

                const tex = new THREE.CanvasTexture(canvas);
                const label = new THREE.Mesh(
                    new THREE.PlaneGeometry(0.5, 0.5).rotateX(-Math.PI/2),
                    new THREE.MeshBasicMaterial({ map: tex, transparent: true })
                );
                label.position.y = 0.01;
                g.add(label);
                return g;
            }
        });
    </script>
</head>

<body style="margin: 0; overflow: hidden;">
    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false;">

        <a-entity 
            circle-grid
            gps-entity-place="latitude: 52.367783; longitude: 13.194566;">
        </a-entity>

        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>
</body>
</html>