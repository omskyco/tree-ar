<!DOCTYPE html>
<html>
<head>
    <title>Grave Mapper - Final Anchor Test</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        .ui { 
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
            z-index: 1000; width: 85%; text-align: center;
        }
        button { 
            padding: 20px; width: 100%; background: #28a745; color: white; 
            border: none; border-radius: 12px; font-weight: bold; font-size: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .stats {
            position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.7);
            color: #0f0; padding: 10px; font-family: monospace; font-size: 12px;
            border-radius: 5px; pointer-events: none;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">

    <div class="stats" id="debug">
        Status: Ready<br>
        Height: 1.7m (Fixed)
    </div>

    <div class="ui">
        <button onclick="placeGrave()">PLACE GRAVE ON FLOOR</button>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false" arjs="sourceType: webcam; debugUIEnabled: false;">
        
        <a-entity id="rig" position="0 1.7 0">
            <a-camera id="cam" look-controls="enabled: true" rotation-reader></a-camera>
        </a-entity>

        <a-entity id="world-anchor"></a-entity>

    </a-scene>

    <script>
        function placeGrave() {
            const cam = document.querySelector('#cam');
            const world = document.querySelector('#world-anchor');
            
            // 1. Get where you are looking
            const rot = cam.getAttribute('rotation');
            const angle = rot.y * (Math.PI / 180);

            // 2. Calculate coordinates 3 meters away on the floor
            const x = -Math.sin(angle) * 3;
            const z = -Math.cos(angle) * 3;

            // 3. Clear previous test objects
            world.innerHTML = '';

            // 4. Create the Grave Marker
            const grave = document.createElement('a-entity');
            grave.setAttribute('position', `${x} 0 ${z}`); // Y is 0 (Ground)
            
            grave.innerHTML = `
                <a-cylinder color="red" height="5" radius="0.05" position="0 2.5 0"></a-cylinder>
                <a-box color="yellow" width="0.8" height="0.05" depth="2" opacity="0.7"></a-box>
                <a-text value="GRAVE SITE" align="center" position="0 0.2 0" rotation="-90 0 0" color="black" width="4"></a-text>
            `;
            
            world.appendChild(grave);
            document.getElementById('debug').innerHTML = `Grave Placed<br>X: ${x.toFixed(2)} Z: ${z.toFixed(2)}`;
        }
    </script>
</body>
</html>