<!DOCTYPE html>
<html>
<head>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #ui {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 9999;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px;
      border-radius: 4px;
      font-family: sans-serif;
    }

    button {
      padding: 6px 10px;
    }
  </style>
</head>

<body>

<div id="ui">
  <button id="placeBtn">Place tree</button>
</div>

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false;"
>
  <a-camera id="camera"></a-camera>

  <!-- Tree anchor -->
  <a-entity id="treeAnchor" visible="false"></a-entity>
</a-scene>

<script>
let anchorPlaced = false;

const placeBtn = document.getElementById("placeBtn");
const anchor = document.getElementById("treeAnchor");

placeBtn.addEventListener("click", () => {
  if (anchorPlaced) return;

  // Place anchor 2 meters in front of camera
  anchor.setAttribute("position", "0 0 -2");
  anchor.setAttribute("rotation", "0 0 0");
  anchor.setAttribute("visible", "true");

  createTreeVisual();
  createGraves();

  anchorPlaced = true;
  placeBtn.disabled = true;
});

function createTreeVisual() {
  const trunk = document.createElement("a-cylinder");
  trunk.setAttribute("radius", "0.25");
  trunk.setAttribute("height", "2");
  trunk.setAttribute("color", "#8B5A2B");
  trunk.setAttribute("position", "0 1 0");

  anchor.appendChild(trunk);
}

function createGraves() {
  const radius = 1.4; // meters from trunk
  const slots = 12;   // adjust to your real count

  for (let i = 0; i < slots; i++) {
    const angle = (i / slots) * Math.PI * 2;

    const x = Math.sin(angle) * radius;
    const z = Math.cos(angle) * radius;

    const circle = document.createElement("a-circle");
    circle.setAttribute("radius", "0.3");
    circle.setAttribute("rotation", "-90 0 0");
    circle.setAttribute("position", `${x} 0 ${z}`);

    const occupied = (i % 3 === 0); // demo logic
    circle.setAttribute(
      "material",
      `color: ${occupied ? "red" : "green"}; opacity: 0.8`
    );

    const label = document.createElement("a-text");
    label.setAttribute("value", i + 1);
    label.setAttribute("align", "center");
    label.setAttribute("position", "0 0.01 0");
    label.setAttribute("scale", "2 2 2");
    label.setAttribute("color", "black");

    circle.appendChild(label);
    anchor.appendChild(circle);
  }
}
</script>

</body>
</html>
