<!DOCTYPE html>
<html>
<head>
    <title>Hybrid GPS Anchor</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        .ui { position: fixed; top: 10px; left: 10px; z-index: 999; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 8px; font-family: monospace; font-size: 12px; }
        input { width: 100px; background: #222; color: #0f0; border: 1px solid #444; }
        button { background: #28a745; color: white; border: none; padding: 5px 10px; cursor: pointer; }
    </style>
</head>

<body style="margin: 0; overflow: hidden;">

    <div class="ui">
        Accuracy: <span id="acc">0</span>m | Dist: <span id="dist">0</span>m<br>
        Target Lat: <input type="number" id="tLat" value="52.367745" step="0.000001"><br>
        Target Lon: <input type="number" id="tLon" value="13.194577" step="0.000001"><br>
        <button onclick="manualUpdate()">MANUAL SYNC</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-camera id="cam" rotation-reader></a-camera>
        
        <a-entity id="pin-container">
            <a-cylinder color="red" height="100" radius="0.2" position="0 0 -5"></a-cylinder>
        </a-entity>
    </a-scene>

    <script>
        const pin = document.getElementById('pin-container');
        
        function manualUpdate() {
            navigator.geolocation.getCurrentPosition((pos) => {
                const myLat = pos.coords.latitude;
                const myLon = pos.coords.longitude;
                const tLat = parseFloat(document.getElementById('tLat').value);
                const tLon = parseFloat(document.getElementById('tLon').value);

                // Calculate distance in meters (X and Z axis)
                // 1 degree lat is ~111,320 meters
                const deltaY = (tLat - myLat) * 111320;
                const deltaX = (tLon - myLon) * (40075000 * Math.cos(myLat * Math.PI/180) / 360);

                // Update the visual stats
                document.getElementById('acc').innerText = pos.coords.accuracy.toFixed(1);
                const totalDist = Math.sqrt(deltaX*deltaX + deltaY*deltaY);
                document.getElementById('dist').innerText = totalDist.toFixed(1);

                // Move the object to that offset relative to our starting 0,0,0
                // In A-Frame: X is Left/Right, Z is Forward/Back (-Z is North-ish)
                pin.setAttribute('position', `${deltaX} 0 ${-deltaY}`);
                
                console.log(`Moving Pin to offset: X:${deltaX} Z:${-deltaY}`);
            }, (err) => alert(err.message), { enableHighAccuracy: true });
        }

        // Auto-sync every 2 seconds
        setInterval(manualUpdate, 2000);
    </script>
</body>
</html>