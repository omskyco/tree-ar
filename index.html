<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Grave Grid - Production</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;">

        <a-camera 
            gps-camera="minDistance: 1; maxDistance: 1000; gpsMinDistance: 1;" 
            rotation-reader>
        </a-camera>

        <a-entity 
            id="tree-center" 
            gps-entity-place="latitude: 52.367967; longitude: 13.194498;">
        </a-entity>

    </a-scene>

    <script>
        window.onload = () => {
            const tree = document.querySelector('#tree-center');

            // INNER SQUARE: Graves 1-16 (2m radius)
            renderGrid(tree, 1, 16, 2, "#00ff00"); 
            
            // OUTER SQUARE: Graves 17-40 (4m radius)
            renderGrid(tree, 17, 40, 4, "#00ffff");
        };

        function renderGrid(parent, start, end, radius, color) {
            const count = (end - start) + 1;
            const perSide = count / 4;
            const step = (radius * 2) / perSide;

            for (let i = 0; i < count; i++) {
                const graveEntity = document.createElement('a-entity');
                let x = 0, z = 0;
                const side = Math.floor(i / perSide);
                const progress = (i % perSide) * step - radius;

                // North = -Z, East = +X, South = +Z, West = -X
                if (side === 0) { x = progress; z = -radius; } 
                else if (side === 1) { x = radius; z = progress; } 
                else if (side === 2) { x = -progress; z = radius; } 
                else if (side === 3) { x = -radius; z = -progress; }

                graveEntity.setAttribute('position', `${x} 0 ${z}`);

                // Visual Circle
                const ring = document.createElement('a-ring');
                ring.setAttribute('radius-inner', '0.35');
                ring.setAttribute('radius-outer', '0.45');
                ring.setAttribute('color', color);
                ring.setAttribute('rotation', '-90 0 0');
                // Added high contrast for outdoor sun
                ring.setAttribute('material', 'shader: flat; opacity: 1'); 
                graveEntity.appendChild(ring);

                // Grave Number
                const text = document.createElement('a-text');
                text.setAttribute('value', start + i);
                text.setAttribute('align', 'center');
                text.setAttribute('scale', '4 4 4'); 
                text.setAttribute('position', '0 1 0');
                text.setAttribute('color', '#ffffff');
                text.setAttribute('look-at', '[gps-camera]');
                graveEntity.appendChild(text);

                parent.appendChild(graveEntity);
            }
        }
    </script>
</body>
</html>