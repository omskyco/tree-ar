<!DOCTYPE html>
<html>
<head>
    <title>Manual GeoAR Placement</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        .ui-panel {
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
            z-index: 100; background: rgba(0,0,0,0.8); color: white; padding: 15px;
            border-radius: 8px; font-family: sans-serif; width: 80%;
        }
        input { width: 100%; margin: 5px 0; padding: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; cursor: pointer; font-weight: bold; }
        label { font-size: 12px; }
    </style>
</head>

<body style="margin: 0; overflow: hidden;">

    <div class="ui-panel">
        <label>Tree Latitude:</label>
        <input type="number" id="latInput" step="0.000001" value="52.367745">
        <label>Tree Longitude:</label>
        <input type="number" id="lonInput" step="0.000001" value="13.194577">
        <button onclick="deployHoles()">UPDATE HOLES</button>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false" arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        // Run once on load so the user doesn't have to click
        window.onload = () => {
            deployHoles();
        };

        function deployHoles() {
            const treeLat = parseFloat(document.getElementById('latInput').value);
            const treeLon = parseFloat(document.getElementById('lonInput').value);

            if(!treeLat || !treeLon) {
                alert("Please enter valid coordinates!");
                return;
            }

            // Clean up existing holes
            document.querySelectorAll('.ar-hole').forEach(el => el.remove());

            // "Off East" correction: Increase this to move the yellow ring further East
            const eastCorrection = 0.00001; 

            const positions = [
                { lat: treeLat + 0.00002, lon: treeLon, color: 'red', label: 'North' },
                { lat: treeLat - 0.00002, lon: treeLon, color: 'blue', label: 'South' },
                { lat: treeLat, lon: treeLon + 0.00002 + eastCorrection, color: 'yellow', label: 'East' },
                { lat: treeLat, lon: treeLon - 0.00002, color: 'green', label: 'West' }
            ];

            const scene = document.querySelector('a-scene');

            positions.forEach(pos => {
                const ring = document.createElement('a-ring');
                ring.setAttribute('class', 'ar-hole');
                ring.setAttribute('gps-entity-place', `latitude: ${pos.lat}; longitude: ${pos.lon};`);
                ring.setAttribute('color', pos.color);
                ring.setAttribute('radius-inner', '0.3');
                ring.setAttribute('radius-outer', '0.5');
                ring.setAttribute('rotation', '-90 0 0'); // Flat on ground
                
                // Text label that always faces the camera
                const text = document.createElement('a-text');
                text.setAttribute('value', pos.label);
                text.setAttribute('scale', '15 15 15'); // Made slightly larger for visibility
                text.setAttribute('look-at', '[gps-camera]');
                text.setAttribute('align', 'center');
                text.setAttribute('position', '0 1 0'); // Hovering 1 meter above the ring
                ring.appendChild(text);

                scene.appendChild(ring);
            });
        }
    </script>
</body>
</html>