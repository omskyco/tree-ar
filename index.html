<!DOCTYPE html>
<html>
<head>
    <title>GeoAR Manual Debug</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: monospace; }
        .ui-panel {
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
            z-index: 1000; background: rgba(0,0,0,0.85); color: white; padding: 15px;
            border-radius: 10px; width: 90%; max-width: 350px; border: 1px solid #444;
        }
        .debug-data { color: #00ff00; margin-bottom: 10px; font-size: 12px; line-height: 1.4; }
        input { width: 100%; margin: 5px 0; background: #222; color: #fff; border: 1px solid #555; padding: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; cursor: pointer; font-weight: bold; margin-top: 5px; }
        .warning { color: #ff4444; font-weight: bold; }
    </style>
</head>

<body style="margin: 0; overflow: hidden;">

    <div class="ui-panel">
        <div class="debug-data" id="stats">
            GPS Accuracy: Waiting...<br>
            Current Pos: ...
        </div>
        <hr style="border: 0.5px solid #444">
        <label>Set Target Latitude:</label>
        <input type="number" id="latInput" step="0.000001" value="52.367745">
        <label>Set Target Longitude:</label>
        <input type="number" id="lonInput" step="0.000001" value="13.194577">
        <button onclick="updateTarget()">DEPLOY PIN AT THESE COORDS</button>
    </div>

    <a-scene 
        embedded 
        vr-mode-ui="enabled: false" 
        arjs="sourceType: webcam; debugUIEnabled: false;">

        <a-camera gps-camera="gpsMinDistance: 1;" rotation-reader></a-camera>
        <a-entity id="target-container"></a-entity>

    </a-scene>

    <script>
        // Monitor actual GPS hardware accuracy
        window.onload = () => {
            if ("geolocation" in navigator) {
                navigator.geolocation.watchPosition((position) => {
                    const acc = position.coords.accuracy;
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    
                    const statusColor = acc > 20 ? 'red' : '#00ff00';
                    const div = document.getElementById('stats');
                    div.innerHTML = `
                        GPS ACCURACY: <span style="color:${statusColor}">${acc.toFixed(1)} meters</span><br>
                        YOUR LAT: ${lat.toFixed(6)}<br>
                        YOUR LON: ${lon.toFixed(6)}<br>
                        ${acc > 20 ? '<span class="warning">(!) SIGNAL TOO WEAK TO ANCHOR</span>' : '<span>(+) SIGNAL OK</span>'}
                    `;
                }, (err) => {
                    document.getElementById('stats').innerHTML = "GPS Error: " + err.message;
                }, { enableHighAccuracy: true, maximumAge: 0 });
            }
            updateTarget(); // Initial deploy
        };

        function updateTarget() {
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            const container = document.querySelector('#target-container');
            
            container.innerHTML = ''; // Remove old pin

            const pin = document.createElement('a-cylinder');
            pin.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lon};`);
            pin.setAttribute('color', '#ff4444');
            pin.setAttribute('height', '30'); 
            pin.setAttribute('radius', '0.15');
            
            container.appendChild(pin);
            console.log("Pin moved to:", lat, lon);
        }
    </script>
</body>
</html>